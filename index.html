<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regula Falsi Method | Numerical Methods Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600;700&family=JetBrains+Mono:wght@400;500&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --bg-primary: #fdfdf9;
            --bg-secondary: #f5f3ed;
            --bg-tertiary: #ebe8dd;
            --text-primary: #1a1614;
            --text-secondary: #4a443e;
            --text-muted: #6e675e;
            --accent-primary: #8b4513;
            --accent-secondary: #d4a574;
            --accent-light: #f4e4cc;
            --border-color: #d4cec1;
            --success: #2d5016;
            --error: #8b1e1e;
            --warning: #8b6914;
            --shadow: rgba(26, 22, 20, 0.08);
            --shadow-lg: rgba(26, 22, 20, 0.15);
            --nav-height: 70px;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1614;
            --bg-secondary: #242018;
            --bg-tertiary: #2e2920;
            --text-primary: #f5f3ed;
            --text-secondary: #cec9be;
            --text-muted: #9e9588;
            --accent-primary: #d4a574;
            --accent-secondary: #8b4513;
            --accent-light: #3d3020;
            --border-color: #3d3528;
            --success: #6b8e4e;
            --error: #d45d5d;
            --warning: #d4a547;
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-lg: rgba(0, 0, 0, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Crimson Pro', serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            transition: background 0.4s ease, color 0.4s ease;
            overflow-x: hidden;
        }

        /* ===================== NAVBAR ===================== */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            z-index: 1000;
            backdrop-filter: blur(12px);
            transition: all 0.4s ease;
        }

        header.scrolled {
            box-shadow: 0 4px 20px var(--shadow-lg);
        }

        nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            height: var(--nav-height);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--accent-primary);
            letter-spacing: -0.5px;
            white-space: nowrap;
            cursor: pointer;
            text-decoration: none;
        }

        /* Nav Links */
        .nav-links {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            list-style: none;
            flex: 1;
            justify-content: center;
        }

        .nav-links li a,
        .nav-links li button {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 0.85rem;
            border-radius: 8px;
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-decoration: none;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.25s ease;
            white-space: nowrap;
        }

        .nav-links li a:hover,
        .nav-links li button:hover {
            background: var(--accent-light);
            color: var(--accent-primary);
        }

        .nav-links li a.active,
        .nav-links li button.active {
            background: var(--accent-light);
            color: var(--accent-primary);
        }

        .nav-links .nav-icon {
            font-size: 0.95rem;
        }

        /* Calculator FAB in Navbar */
        .nav-calc-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.55rem 1.2rem;
            background: var(--accent-primary);
            color: rgb(94, 92, 92)!important;
            border-radius: 8px;
            font-weight: 700 !important;
            font-size: 0.95rem !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 3px 12px var(--shadow);
        }

        .nav-calc-btn:hover {
            background: var(--accent-secondary) !important;
            transform: translateY(-2px);
            box-shadow: 0 5px 18px var(--shadow-lg) !important;
            color: white !important;
        }

        /* Nav Right Group */
        .nav-right {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        /* Hamburger */
        .hamburger {
            display: none;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .hamburger:hover { background: var(--accent-light); }

        .hamburger span {
            display: block;
            width: 22px;
            height: 2px;
            background: var(--text-primary);
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger.open span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
        .hamburger.open span:nth-child(2) { opacity: 0; }
        .hamburger.open span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

        /* Mobile Menu */
        .mobile-menu {
            display: none;
            position: fixed;
            top: var(--nav-height);
            left: 0;
            width: 100%;
            background: var(--bg-primary);
            border-bottom: 2px solid var(--border-color);
            padding: 1rem;
            z-index: 999;
            flex-direction: column;
            gap: 0.4rem;
            box-shadow: 0 8px 30px var(--shadow-lg);
            animation: slideDown 0.3s ease;
        }

        .mobile-menu.open { display: flex; }

        .mobile-menu a,
        .mobile-menu button {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.8rem 1rem;
            border-radius: 8px;
            font-family: 'Crimson Pro', serif;
            font-size: 1.05rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-decoration: none;
            background: none;
            border: none;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease;
        }

        .mobile-menu a:hover,
        .mobile-menu button:hover {
            background: var(--accent-light);
            color: var(--accent-primary);
        }

        .mobile-calc-btn {
            background: var(--accent-primary) !important;
            color: white !important;
            margin-top: 0.4rem;
        }

        /* Theme Toggle */
        .theme-toggle {
            width: 48px;
            height: 25px;
            background: var(--bg-tertiary);
            border-radius: 13px;
            border: 1px solid var(--border-color);
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .theme-toggle::before {
            content: '‚òÄ';
            position: absolute;
            left: 3px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 13px;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .theme-toggle::before {
            content: '‚òæ';
            left: calc(100% - 22px);
        }

        /* Floating Calc Button (visible on all pages, bottom right) */
        .float-calc-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 58px;
            height: 58px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 6px 20px var(--shadow-lg);
            transition: all 0.3s ease;
            z-index: 998;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .float-calc-btn:hover {
            transform: scale(1.12) translateY(-3px);
            background: var(--accent-secondary);
            box-shadow: 0 10px 28px var(--shadow-lg);
        }

        .float-calc-btn .tooltip-label {
            position: absolute;
            right: 68px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-family: 'Crimson Pro', serif;
            font-weight: 600;
            white-space: nowrap;
            border: 1px solid var(--border-color);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }

        .float-calc-btn:hover .tooltip-label {
            opacity: 1;
        }

        /* ===================== HERO ===================== */
        .hero {
            margin-top: var(--nav-height);
            padding: 6rem 2rem 4rem;
            text-align: center;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(circle at 20% 30%, var(--accent-light) 0%, transparent 30%),
                radial-gradient(circle at 80% 70%, var(--accent-light) 0%, transparent 30%);
            opacity: 0.3;
            pointer-events: none;
        }

        .hero-content {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            font-weight: 900;
            color: var(--accent-primary);
            margin-bottom: 1rem;
            line-height: 1.1;
            animation: fadeInUp 0.8s ease;
        }

        .hero .subtitle {
            font-size: clamp(1.1rem, 2vw, 1.4rem);
            color: var(--text-secondary);
            margin-bottom: 2.5rem;
            font-weight: 300;
            animation: fadeInUp 0.8s ease 0.2s both;
        }

        .hero-cta {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            animation: fadeInUp 0.8s ease 0.4s both;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===================== LAYOUT ===================== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        section {
            padding: 4rem 0;
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 2rem;
            text-align: center;
        }

        /* ===================== CARDS ===================== */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px var(--shadow);
            transition: all 0.3s ease;
        }

        .card:hover { transform: translateY(-4px); box-shadow: 0 8px 30px var(--shadow-lg); }

        .card h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: var(--accent-primary);
            margin-bottom: 1.2rem;
        }

        .card p, .card li { color: var(--text-secondary); margin-bottom: 1rem; font-size: 1.05rem; }
        .card ul, .card ol { margin-left: 1.5rem; }

        /* ===================== FORMULA ===================== */
        .formula {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-primary);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            text-align: center;
            overflow-x: auto;
        }

        /* ===================== COLLAPSIBLE ===================== */
        .collapsible {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .collapsible::after { content: '‚ñº'; font-size: 0.8rem; transition: transform 0.3s ease; }
        .collapsible.active::after { transform: rotate(-180deg); }

        .collapsible-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; }
        .collapsible-content.active { max-height: 3000px; }

        /* ===================== CALCULATOR ===================== */
        .calculator {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-secondary);
            border-radius: 16px;
            padding: 3rem;
            box-shadow: 0 8px 40px var(--shadow-lg);
        }

        .input-group { margin-bottom: 1.8rem; }

        .input-group label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.6rem;
            font-size: 1.05rem;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }

        .checkbox-group { display: flex; align-items: center; gap: 0.8rem; margin-bottom: 1.5rem; }
        .checkbox-group input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }

        /* ===================== BUTTONS ===================== */
        .btn {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Crimson Pro', serif;
        }

        .btn-primary { background: var(--accent-primary); color: white; box-shadow: 0 4px 15px var(--shadow); }
        .btn-primary:hover { background: var(--accent-secondary); transform: translateY(-2px); box-shadow: 0 6px 20px var(--shadow-lg); }

        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background: var(--bg-primary); }

        .btn-export { background: var(--success); color: white; }
        .btn-export:hover { background: #3d6a1f; }

        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* ===================== RESULTS ===================== */
        .results { margin-top: 3rem; animation: slideIn 0.5s ease; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .iteration-display {
            background: var(--bg-tertiary);
            border: 2px solid var(--accent-primary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .iteration-display h3 { color: var(--accent-primary); margin-bottom: 1.2rem; font-family: 'Playfair Display', serif; }

        .calculation-step {
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.8rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            border-left: 3px solid var(--accent-secondary);
        }

        .calculation-step strong { color: var(--accent-primary); }

        /* ===================== TABLE ===================== */
        .table-container {
            overflow-x: auto;
            margin-top: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow);
        }

        table { width: 100%; border-collapse: collapse; background: var(--bg-secondary); }

        th, td {
            padding: 1rem;
            text-align: center;
            border: 1px solid var(--border-color);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        th { background: var(--accent-primary); color: white; font-weight: 600; position: sticky; top: 0; }
        tr:hover { background: var(--bg-tertiary); }
        tr.converged { background: var(--accent-light); font-weight: 600; }

        /* ===================== PROGRESS ===================== */
        .progress-container { margin: 2rem 0; }

        .progress-bar { width: 100%; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .progress-text { text-align: center; margin-top: 0.5rem; color: var(--text-muted); font-size: 0.9rem; }

        /* ===================== ALERTS ===================== */
        .alert {
            padding: 1.2rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 4px solid;
            animation: slideDown 0.4s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-error { background: rgba(139, 30, 30, 0.1); border-color: var(--error); color: var(--error); }
        .alert-success { background: rgba(45, 80, 22, 0.1); border-color: var(--success); color: var(--success); }
        .alert-warning { background: rgba(139, 105, 20, 0.1); border-color: var(--warning); color: var(--warning); }

        /* ===================== EXAMPLE BOX ===================== */
        .example-box { background: var(--bg-tertiary); border-radius: 12px; padding: 2rem; margin: 2rem 0; }
        .example-step { margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); }
        .example-step:last-child { border-bottom: none; }
        .example-step h4 { color: var(--accent-primary); margin-bottom: 0.8rem; font-size: 1.2rem; }

        /* ===================== TOOLTIP ===================== */
        .tooltip { position: relative; display: inline-block; cursor: help; color: var(--accent-primary); font-weight: 600; border-bottom: 1px dotted var(--accent-primary); }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 280px;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            text-align: left;
            border-radius: 8px;
            padding: 1rem;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px var(--shadow-lg);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--bg-tertiary) transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        /* ===================== PRESETS ===================== */
        .presets-container { display: flex; gap: 0.8rem; flex-wrap: wrap; margin-bottom: 1.5rem; }

        .preset-btn {
            padding: 0.6rem 1.2rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
        }

        .preset-btn:hover { background: var(--accent-light); border-color: var(--accent-primary); transform: translateY(-2px); }

        /* ===================== GRAPH ===================== */
        .graph-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .graph-container h3 { color: var(--accent-primary); margin-bottom: 1.5rem; font-family: 'Playfair Display', serif; }

        /* ===================== COPY BUTTON ===================== */
        .copy-btn {
            padding: 0.4rem 0.8rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-left: 0.5rem;
            transition: all 0.2s ease;
        }

        .copy-btn:hover { background: var(--accent-light); border-color: var(--accent-primary); }

        /* ===================== VALIDATION ===================== */
        .input-valid { border-color: var(--success) !important; }
        .input-invalid { border-color: var(--error) !important; }
        .validation-message { font-size: 0.85rem; margin-top: 0.4rem; display: block; }
        .validation-success { color: var(--success); }
        .validation-error { color: var(--error); }

        /* ===================== SCROLL INDICATOR ===================== */
        .scroll-indicator { position: fixed; top: var(--nav-height); left: 0; width: 100%; height: 3px; background: var(--bg-tertiary); z-index: 999; }
        .scroll-progress { height: 100%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); width: 0%; transition: width 0.1s ease; }

        /* ===================== STATS GRID ===================== */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 2rem 0; }

        .stat-card { background: var(--bg-tertiary); padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid var(--border-color); }
        .stat-card .stat-value { font-size: 2rem; font-weight: 700; color: var(--accent-primary); font-family: 'JetBrains Mono', monospace; }
        .stat-card .stat-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 0.5rem; }

        /* ===================== COMPARE MODE ===================== */
        .compare-mode {
            background: var(--accent-light);
            border: 2px dashed var(--accent-primary);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
        }

        /* ===================== FEATURES SECTION ===================== */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .feature-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 12px var(--shadow);
        }

        .feature-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 8px 28px var(--shadow-lg);
            border-color: var(--accent-secondary);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .feature-card h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            color: var(--accent-primary);
            margin-bottom: 0.8rem;
        }

        .feature-card p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* ===================== COMPARISON TABLE ===================== */
        .method-compare-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }

        .method-compare-table th {
            background: var(--accent-primary);
            color: white;
            padding: 0.9rem 1.2rem;
            text-align: left;
        }

        .method-compare-table td {
            padding: 0.9rem 1.2rem;
            border: 1px solid var(--border-color);
            text-align: left;
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
        }

        .method-compare-table tr:nth-child(even) {
            background: var(--bg-tertiary);
        }

        .check { color: var(--success); font-weight: 700; }
        .cross { color: var(--error); font-weight: 700; }

        /* ===================== FOOTER ===================== */
        footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 3rem 2rem;
            text-align: center;
            margin-top: 4rem;
        }

        footer p { color: var(--text-muted); }

        /* ===================== RESPONSIVE ===================== */
        @media (max-width: 900px) {
            .nav-links { display: none; }
            .hamburger { display: flex; }
        }

        @media (max-width: 768px) {
            nav { padding: 0 1rem; }
            .hero { padding: 4rem 1rem 2rem; }
            .card, .calculator { padding: 1.5rem; }
            .input-row { grid-template-columns: 1fr; }
            .btn { width: 100%; margin-bottom: 0.8rem; }
            table { font-size: 0.75rem; }
            th, td { padding: 0.6rem; }
            .float-calc-btn { bottom: 20px; right: 20px; }
        }

        /* ===================== UTILITY ===================== */
        .hidden { display: none !important; }

        @keyframes slideDown {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media print {
            header, footer, .float-calc-btn, .scroll-indicator { display: none !important; }
            .card, .calculator { box-shadow: none !important; page-break-inside: avoid; }
        }
    </style>
</head>
<body data-theme="light">

    <!-- Scroll Progress Bar -->
    <div class="scroll-indicator">
        <div class="scroll-progress" id="scrollProgress"></div>
    </div>

    <!-- ===================== NAVBAR ===================== -->
    <header id="mainHeader">
        <nav>
            <a class="logo" onclick="scrollToTop()">Regula Falsi</a>

            <!-- Desktop Nav Links -->
            <ul class="nav-links" id="desktopNav">
                <li><a href="#about" onclick="smoothScroll(event,'about')"><span class="nav-icon">üìñ</span> About</a></li>
                <li><a href="#formula" onclick="smoothScroll(event,'formula')"><span class="nav-icon">üìê</span> Formula</a></li>
                <li><a href="#algorithm" onclick="smoothScroll(event,'algorithm')"><span class="nav-icon">üî¢</span> Algorithm</a></li>
                <li><a href="#examples" onclick="smoothScroll(event,'examples')"><span class="nav-icon">‚úèÔ∏è</span> Examples</a></li>
                <li><a href="#applications" onclick="smoothScroll(event,'applications')"><span class="nav-icon">üåç</span> Applications</a></li>
                <li><a href="#features" onclick="smoothScroll(event,'features')"><span class="nav-icon">‚≠ê</span> Features</a></li>
                <li><a href="#calculator-section" class="nav-calc-btn" onclick="smoothScroll(event,'calculator-section')">
                    <span>üßÆ</span> Calculator
                </a></li>
            </ul>

            <!-- Right: theme + hamburger -->
            <div class="nav-right">
                <div class="theme-toggle" onclick="toggleTheme()" title="Toggle theme"></div>
                <div class="hamburger" id="hamburger" onclick="toggleMobileMenu()">
                    <span></span><span></span><span></span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a onclick="mobileSmoothScroll('about')"><span>üìñ</span> About the Method</a>
        <a onclick="mobileSmoothScroll('formula')"><span>üìê</span> Formula</a>
        <a onclick="mobileSmoothScroll('algorithm')"><span>üî¢</span> Algorithm</a>
        <a onclick="mobileSmoothScroll('examples')"><span>‚úèÔ∏è</span> Examples</a>
        <a onclick="mobileSmoothScroll('applications')"><span>üåç</span> Applications</a>
        <a onclick="mobileSmoothScroll('features')"><span>‚≠ê</span> Features</a>
        <button class="mobile-calc-btn" onclick="mobileSmoothScroll('calculator-section')">üßÆ Open Calculator</button>
    </div>

    <!-- ===================== HERO ===================== -->
    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Regula Falsi Method</h1>
            <p class="subtitle">An elegant iterative approach to finding roots of non-linear equations through linear interpolation</p>
            <div class="hero-cta">
                <button class="btn btn-primary" onclick="document.getElementById('calculator-section').scrollIntoView({behavior:'smooth'})">
                    üßÆ Open Calculator
                </button>
                <button class="btn btn-secondary" onclick="document.getElementById('about').scrollIntoView({behavior:'smooth'})">
                    üìñ Learn More
                </button>
            </div>
        </div>
    </section>

    <!-- ===================== MAIN CONTENT ===================== -->
    <main class="container">

        <!-- About Section -->
        <section id="about">
            <div class="card">
                <h3 class="collapsible active">What is the Regula Falsi Method?</h3>
                <div class="collapsible-content active">
                    <p>The <strong>Regula Falsi method</strong>, also known as the <strong>Method of False Position</strong>, is a numerical technique for finding approximate roots of real-valued continuous functions. It combines the reliability of the bisection method with faster convergence by using linear interpolation instead of simple bisection.</p>
                    <p>This method is particularly effective when you have an interval [a, b] where the function changes sign, guaranteeing the presence of at least one root within that interval. Unlike the bisection method which always divides the interval in half, Regula Falsi uses the function values to make a more informed choice about where the root might lie.</p>
                    <p><strong>Historical Context:</strong> The method has ancient origins, with early forms appearing in Indian mathematical texts and later refined by European mathematicians. The name "Regula Falsi" comes from Latin, meaning "rule of false position."</p>
                </div>
            </div>
        </section>

        <!-- Formula Section -->
        <section id="formula">
            <h2 class="section-title">Mathematical Formula</h2>
            <div class="card">
                <h3>The Regula Falsi Formula</h3>
                <p>Given two points (a, f(a)) and (b, f(b)) where f(a) and f(b) have opposite signs, the next approximation x is calculated using:</p>
                <div class="formula">x = a ‚àí [f(a) √ó (b ‚àí a)] / [f(b) ‚àí f(a)]</div>
                <p style="text-align:center;margin-top:1rem;"><em>or equivalently</em></p>
                <div class="formula">x = [a √ó f(b) ‚àí b √ó f(a)] / [f(b) ‚àí f(a)]</div>
                <p>This formula represents the x-intercept of the straight line connecting the points (a, f(a)) and (b, f(b)). The method then updates the interval based on which side of x the root lies.</p>

                <h3 style="margin-top:2rem;">Method Comparison</h3>
                <div style="overflow-x:auto;">
                    <table class="method-compare-table">
                        <thead>
                            <tr>
                                <th>Property</th>
                                <th>Regula Falsi</th>
                                <th>Bisection</th>
                                <th>Newton-Raphson</th>
                                <th>Secant</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>Convergence</td><td>Linear (superlinear)</td><td>Linear</td><td>Quadratic</td><td>Superlinear (~1.618)</td></tr>
                            <tr><td>Bracketing required</td><td><span class="check">‚úì Yes</span></td><td><span class="check">‚úì Yes</span></td><td><span class="cross">‚úó No</span></td><td><span class="cross">‚úó No</span></td></tr>
                            <tr><td>Derivative needed</td><td><span class="check">‚úì No</span></td><td><span class="check">‚úì No</span></td><td><span class="cross">‚úó Yes</span></td><td><span class="check">‚úì No</span></td></tr>
                            <tr><td>Guaranteed convergence</td><td><span class="check">‚úì Yes</span></td><td><span class="check">‚úì Yes</span></td><td><span class="cross">‚úó Conditional</span></td><td><span class="cross">‚úó Conditional</span></td></tr>
                            <tr><td>Speed vs Bisection</td><td>Faster (usually)</td><td>Baseline</td><td>Much faster</td><td>Faster</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Algorithm Section -->
        <section id="algorithm">
            <h2 class="section-title">Algorithm Steps</h2>
            <div class="card">
                <h3>Step-by-Step Procedure</h3>
                <ol>
                    <li><strong>Initialize:</strong> Choose two initial points a and b such that f(a) √ó f(b) &lt; 0 (opposite signs), ensuring a root exists in [a, b].</li>
                    <li><strong>Calculate New Approximation:</strong> Compute x using the Regula Falsi formula:<br>
                    <span style="font-family:'JetBrains Mono',monospace;display:block;margin:0.5rem 0;">x = a ‚àí [f(a) √ó (b ‚àí a)] / [f(b) ‚àí f(a)]</span></li>
                    <li><strong>Evaluate Function:</strong> Calculate f(x) at the new approximation.</li>
                    <li><strong>Check Convergence:</strong> If |f(x)| &lt; Œµ (tolerance) or the error criterion is met, accept x as the root and stop.</li>
                    <li><strong>Update Interval:</strong>
                        <ul>
                            <li>If f(a) √ó f(x) &lt; 0, the root lies in [a, x], so set b = x</li>
                            <li>If f(x) √ó f(b) &lt; 0, the root lies in [x, b], so set a = x</li>
                        </ul>
                    </li>
                    <li><strong>Iterate:</strong> Return to step 2 and repeat until convergence or maximum iterations reached.</li>
                </ol>
            </div>

            <!-- Working Principle -->
            <div class="card">
                <h3>Working Principle</h3>
                <p><strong>Linear Interpolation:</strong> Instead of blindly bisecting the interval, the method draws a straight line (secant) between the two endpoints (a, f(a)) and (b, f(b)). The x-intercept of this line provides the next approximation.</p>
                <p><strong>Bracketing:</strong> Like the bisection method, Regula Falsi maintains a bracket around the root. At each iteration, one endpoint of the interval is replaced with the new approximation, always ensuring the root remains bracketed.</p>
                <p><strong>Convergence Behavior:</strong> The method typically converges faster than bisection because it uses function values to make intelligent guesses. However, in some cases, one endpoint may remain fixed while the other converges to the root (called "slow convergence").</p>
                <p><strong>Geometric Interpretation:</strong> Imagine connecting two points on a curve with a straight line. Where this line crosses the x-axis is likely closer to where the curve itself crosses the x-axis compared to simply taking the midpoint.</p>
            </div>

            <!-- Pros & Cons -->
            <div class="input-row">
                <div class="card" style="background:rgba(45,80,22,0.05);">
                    <h3 style="color:var(--success);">‚úì Advantages</h3>
                    <ul>
                        <li><strong>Guaranteed Convergence:</strong> Always converges if the initial interval brackets a root</li>
                        <li><strong>No Derivative Required:</strong> Only function evaluations needed</li>
                        <li><strong>Faster than Bisection:</strong> Generally converges faster due to linear interpolation</li>
                        <li><strong>Simple Implementation:</strong> Straightforward algorithm, easy to code</li>
                        <li><strong>Robust:</strong> Handles many types of continuous functions reliably</li>
                        <li><strong>Visual Clarity:</strong> Geometric interpretation makes it intuitive</li>
                    </ul>
                </div>
                <div class="card" style="background:rgba(139,30,30,0.05);">
                    <h3 style="color:var(--error);">‚úó Limitations</h3>
                    <ul>
                        <li><strong>Slower than Newton's Method:</strong> Linear vs quadratic convergence</li>
                        <li><strong>One Endpoint May Stagnate:</strong> Can have slow convergence in some cases</li>
                        <li><strong>Requires Bracket:</strong> Must find initial interval where function changes sign</li>
                        <li><strong>Only One Root:</strong> Finds only one root in the given interval</li>
                        <li><strong>Not for Multiple Roots:</strong> Struggles with roots of even multiplicity</li>
                        <li><strong>Sensitive to Bracket Quality:</strong> Poor bracket can slow convergence</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Examples Section -->
        <section id="examples">
            <h2 class="section-title">Manually Solved Example</h2>
            <div class="card">
                <h3>Example Problem</h3>
                <p><strong>Find the root of f(x) = x¬≥ ‚àí x ‚àí 1 in the interval [1, 2] using the Regula Falsi method (tolerance = 0.01)</strong></p>

                <div class="example-box">
                    <div class="example-step">
                        <h4>Step 1: Verify Initial Conditions</h4>
                        <p>Given: a = 1, b = 2</p>
                        <p>f(a) = f(1) = 1¬≥ ‚àí 1 ‚àí 1 = ‚àí1</p>
                        <p>f(b) = f(2) = 2¬≥ ‚àí 2 ‚àí 1 = 5</p>
                        <p>Since f(1) √ó f(2) = ‚àí1 √ó 5 = ‚àí5 &lt; 0, a root exists in [1, 2] ‚úì</p>
                    </div>
                    <div class="example-step">
                        <h4>Iteration 1</h4>
                        <div class="formula">x‚ÇÅ = 1 ‚àí [(‚àí1) √ó (2 ‚àí 1)] / [5 ‚àí (‚àí1)] = 1 + 1/6 ‚âà 1.1667</div>
                        <p>f(x‚ÇÅ) = f(1.1667) ‚âà ‚àí0.5813 ‚Üí Update: a = 1.1667, b = 2</p>
                    </div>
                    <div class="example-step">
                        <h4>Iteration 2</h4>
                        <div class="formula">x‚ÇÇ = 1.1667 ‚àí [(‚àí0.5813) √ó 0.8333] / [5.5813] ‚âà 1.2535</div>
                        <p>f(x‚ÇÇ) ‚âà ‚àí0.2848 ‚Üí Update: a = 1.2535, b = 2</p>
                    </div>
                    <div class="example-step">
                        <h4>Iterations 3‚Äì5 (summary)</h4>
                        <p>x‚ÇÉ ‚âà 1.2937, f(x‚ÇÉ) ‚âà ‚àí0.1293</p>
                        <p>x‚ÇÑ ‚âà 1.3115, f(x‚ÇÑ) ‚âà ‚àí0.0568</p>
                        <p>x‚ÇÖ ‚âà 1.3195, f(x‚ÇÖ) ‚âà ‚àí0.0245</p>
                    </div>
                    <div class="example-step">
                        <h4>Iteration 6</h4>
                        <div class="formula">x‚ÇÜ ‚âà 1.3247, f(x‚ÇÜ) ‚âà ‚àí0.0105</div>
                        <p>|f(x‚ÇÜ)| ‚âà 0.01 ‚Äî convergence achieved!</p>
                    </div>
                    <div class="example-step" style="border:2px solid var(--success);background:rgba(45,80,22,0.05);border-radius:8px;padding:1rem;">
                        <h4>‚úì Solution</h4>
                        <p><strong>Approximate root: x ‚âà 1.3247 (6 iterations)</strong></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Applications Section -->
        <section id="applications">
            <h2 class="section-title">Real-Life Applications</h2>
            <div class="card">
                <h3>Where Regula Falsi is Used</h3>
                <ul>
                    <li><strong>Engineering Design:</strong> Finding equilibrium points in mechanical systems, stress-strain analysis, and structural optimization</li>
                    <li><strong>Financial Mathematics:</strong> Calculating internal rate of return (IRR), break-even analysis, and bond pricing equations</li>
                    <li><strong>Physics & Astronomy:</strong> Solving transcendental equations in orbital mechanics, wave propagation, and quantum mechanics</li>
                    <li><strong>Chemical Engineering:</strong> Determining reaction equilibrium, mass balance equations, and process optimization</li>
                    <li><strong>Electrical Engineering:</strong> Circuit analysis, non-linear operating points, and control system design</li>
                    <li><strong>Economics:</strong> Market equilibrium calculations, supply-demand intersection, and economic modeling</li>
                    <li><strong>Environmental Science:</strong> Pollution dispersion models, climate modeling, and resource management</li>
                    <li><strong>Computer Graphics:</strong> Ray-tracing algorithms, collision detection, and surface intersection calculations</li>
                </ul>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features">
            <h2 class="section-title">Calculator Features</h2>
            <p style="text-align:center;color:var(--text-secondary);margin-bottom:2rem;">Everything packed into this interactive solver</p>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üßÆ</div>
                    <h4>Step-by-Step Solver</h4>
                    <p>Walk through each iteration one at a time with full formula breakdown and detailed calculations shown at every step.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìà</div>
                    <h4>Function Graph</h4>
                    <p>Visual plot of f(x) over your chosen interval, with the root clearly marked on the curve using Chart.js.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h4>Quick Presets</h4>
                    <p>Six built-in example functions (polynomials, trig, exponential) so you can explore immediately without typing.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h4>Bisection Comparison</h4>
                    <p>Run both methods simultaneously and compare iteration counts, roots, and convergence speed side by side.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìÑ</div>
                    <h4>PDF Export</h4>
                    <p>Download a formatted PDF of the full iteration table, inputs, and final result ‚Äî perfect for assignments and reports.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîÑ</div>
                    <h4>Auto Bound Search</h4>
                    <p>Don't know a starting interval? The solver can automatically scan and find an interval containing a root.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üåô</div>
                    <h4>Dark / Light Mode</h4>
                    <p>Full theme support with smooth transitions. Toggle from the navbar or press <kbd style="background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;font-size:0.85rem;">Ctrl+D</kbd>.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚å®Ô∏è</div>
                    <h4>Keyboard Shortcuts</h4>
                    <p>Power-user controls: <kbd style="background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;font-size:0.85rem;">Ctrl+Enter</kbd> to solve, <kbd style="background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;font-size:0.85rem;">Ctrl+R</kbd> to reset.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚úîÔ∏è</div>
                    <h4>Live Validation</h4>
                    <p>Real-time feedback as you type ‚Äî verifies function syntax and confirms that your interval brackets a root.</p>
                </div>
            </div>
        </section>

        <!-- Interactive Calculator -->
        <section id="calculator-section">
            <h2 class="section-title">Interactive Solver</h2>
            <div class="calculator" id="calculatorBox">
                <h3 style="margin-bottom:2rem;color:var(--accent-primary);font-family:'Playfair Display',serif;">Calculate Roots Using Regula Falsi Method</h3>

                <!-- Quick Presets -->
                <div style="margin-bottom:2rem;">
                    <label style="display:block;margin-bottom:0.8rem;font-weight:600;">
                        <span class="tooltip">Quick Examples
                            <span class="tooltiptext">Click any example to auto-fill the calculator with a pre-configured problem</span>
                        </span>
                    </label>
                    <div class="presets-container">
                        <button class="preset-btn" onclick="loadPreset('x^3 - x - 1', 1, 2)">x¬≥ ‚àí x ‚àí 1</button>
                        <button class="preset-btn" onclick="loadPreset('x^2 - 4', 1, 3)">x¬≤ ‚àí 4</button>
                        <button class="preset-btn" onclick="loadPreset('cos(x) - x', 0, 1)">cos(x) ‚àí x</button>
                        <button class="preset-btn" onclick="loadPreset('e^x - 3*x', 0, 2)">eÀ£ ‚àí 3x</button>
                        <button class="preset-btn" onclick="loadPreset('x*log(x) - 1', 2, 3)">x¬∑log(x) ‚àí 1</button>
                        <button class="preset-btn" onclick="loadPreset('sin(x) - 0.5', 0, 1)">sin(x) ‚àí 0.5</button>
                    </div>
                </div>

                <div class="input-group">
                    <label for="function">
                        <span class="tooltip">Enter Function f(x)
                            <span class="tooltiptext">
                                <strong>Operators:</strong> +, -, *, /, ^ (power)<br><br>
                                <strong>Functions:</strong> sqrt(), sin(), cos(), tan(), log(), ln(), exp(), abs(), asin(), acos(), atan()<br><br>
                                <strong>Constants:</strong> e, pi
                            </span>
                        </span>:
                    </label>
                    <div style="display:flex;gap:0.5rem;align-items:center;">
                        <input type="text" id="function" placeholder="e.g., x^3 - x - 1" value="x^3 - x - 1" oninput="validateFunction()">
                        <button class="copy-btn" onclick="copyToClipboard('function')" title="Copy">üìã</button>
                    </div>
                    <span id="functionValidation" class="validation-message"></span>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useBounds" checked>
                    <label for="useBounds">
                        <span class="tooltip">Specify interval [a, b]
                            <span class="tooltiptext">Providing an interval where f(a) and f(b) have opposite signs guarantees finding a root.</span>
                        </span>
                    </label>
                </div>

                <div class="input-row" id="boundsInputs">
                    <div class="input-group">
                        <label for="lowerBound">Lower Bound (a):</label>
                        <input type="number" id="lowerBound" step="any" value="1" oninput="validateBounds()">
                    </div>
                    <div class="input-group">
                        <label for="upperBound">Upper Bound (b):</label>
                        <input type="number" id="upperBound" step="any" value="2" oninput="validateBounds()">
                    </div>
                </div>
                <span id="boundsValidation" class="validation-message"></span>

                <div class="input-row">
                    <div class="input-group">
                        <label for="errorType">
                            <span class="tooltip">Error Calculation Type
                                <span class="tooltiptext">
                                    <strong>Absolute:</strong> |x‚Çô ‚àí x‚Çô‚Çã‚ÇÅ|<br><br>
                                    <strong>Relative:</strong> |x‚Çô ‚àí x‚Çô‚Çã‚ÇÅ| / |x‚Çô| √ó 100%
                                </span>
                            </span>:
                        </label>
                        <select id="errorType">
                            <option value="absolute">Absolute Error</option>
                            <option value="relative">Relative Percentage Error</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="tolerance">
                            <span class="tooltip">Tolerance (Œµ)
                                <span class="tooltiptext">The method stops when error falls below this value.</span>
                            </span>:
                        </label>
                        <input type="number" id="tolerance" step="any" value="0.0001" min="0.000001">
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label for="precision">
                            <span class="tooltip">Decimal Precision
                                <span class="tooltiptext">Digits displayed after decimal point (1‚Äì15)</span>
                            </span>:
                        </label>
                        <input type="number" id="precision" min="1" max="15" value="6">
                    </div>
                    <div class="input-group">
                        <label for="maxIterations">
                            <span class="tooltip">Maximum Iterations
                                <span class="tooltiptext">Safety limit to prevent infinite loops.</span>
                            </span>:
                        </label>
                        <input type="number" id="maxIterations" min="1" max="1000" value="100">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="showGraph" checked>
                    <label for="showGraph">
                        <span class="tooltip">Show Function Graph
                            <span class="tooltiptext">Visualize the function over the interval</span>
                        </span>
                    </label>
                </div>

                <div style="display:flex;gap:1rem;margin-top:2rem;flex-wrap:wrap;">
                    <button class="btn btn-primary" onclick="solveRegulaFalsi()" title="Ctrl+Enter">
                        üöÄ Solve &amp; Show First Iteration
                    </button>
                    <button class="btn btn-secondary" onclick="resetCalculator()">
                        üîÑ Reset
                    </button>
                    <button class="btn btn-secondary" onclick="toggleCompareMode()" id="compareBtn">
                        üìä Compare with Bisection
                    </button>
                </div>

                <div id="errorMessage"></div>
                <div id="resultsSection" class="hidden"></div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2024 Regula Falsi Method Calculator | A Comprehensive Academic Tool for Numerical Methods</p>
        <p style="margin-top:0.5rem;font-size:0.9rem;">Designed for students, educators, and engineers</p>
    </footer>

    <!-- Floating Calculator Button -->
    <button class="float-calc-btn" onclick="scrollToCalculator()" title="Go to Calculator">
        üßÆ
        <span class="tooltip-label">Open Calculator</span>
    </button>

    <!-- ===================== SCRIPTS ===================== -->
    <script>
        // ‚îÄ‚îÄ Theme ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function toggleTheme() {
            const body = document.body;
            const newTheme = body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function scrollToCalculator() {
            document.getElementById('calculator-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ‚îÄ‚îÄ Smooth scroll helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function smoothScroll(e, id) {
            e.preventDefault();
            document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'start' });
            // close mobile menu if open
            closeMobileMenu();
        }

        function mobileSmoothScroll(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'start' });
            closeMobileMenu();
        }

        // ‚îÄ‚îÄ Mobile menu ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const ham = document.getElementById('hamburger');
            menu.classList.toggle('open');
            ham.classList.toggle('open');
        }

        function closeMobileMenu() {
            document.getElementById('mobileMenu').classList.remove('open');
            document.getElementById('hamburger').classList.remove('open');
        }

        // Close menu when clicking outside
        document.addEventListener('click', e => {
            const menu = document.getElementById('mobileMenu');
            const ham = document.getElementById('hamburger');
            if (!menu.contains(e.target) && !ham.contains(e.target) && menu.classList.contains('open')) {
                closeMobileMenu();
            }
        });

        // ‚îÄ‚îÄ Active nav link on scroll ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function updateActiveNavLink() {
            const sections = ['about','formula','algorithm','examples','applications','features','calculator-section'];
            const scrollY = window.scrollY + 100;
            let current = '';
            sections.forEach(id => {
                const el = document.getElementById(id);
                if (el && el.offsetTop <= scrollY) current = id;
            });

            document.querySelectorAll('.nav-links li a').forEach(link => {
                link.classList.remove('active');
                const href = link.getAttribute('href');
                if (href && href === '#' + current) link.classList.add('active');
            });
        }

        // ‚îÄ‚îÄ Scroll progress + header shadow ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function updateScrollProgress() {
            const winScroll = document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('scrollProgress').style.width = scrolled + '%';
            document.getElementById('mainHeader').classList.toggle('scrolled', winScroll > 20);
            updateActiveNavLink();
        }

        window.addEventListener('scroll', updateScrollProgress);

        // ‚îÄ‚îÄ Keyboard shortcuts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && e.key === 'Enter') { e.preventDefault(); solveRegulaFalsi(); }
            if (e.ctrlKey && e.key === 'r')     { e.preventDefault(); resetCalculator(); }
            if (e.ctrlKey && e.key === 'd')     { e.preventDefault(); toggleTheme(); }
        });

        // ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);

            // Collapsibles
            document.querySelectorAll('.collapsible').forEach(elem => {
                elem.addEventListener('click', function() {
                    this.classList.toggle('active');
                    this.nextElementSibling.classList.toggle('active');
                });
            });

            // Bounds checkbox
            document.getElementById('useBounds').addEventListener('change', function() {
                document.getElementById('boundsInputs').style.display = this.checked ? 'grid' : 'none';
            });
        });

        // ‚îÄ‚îÄ Preset loader ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function loadPreset(func, a, b) {
            document.getElementById('function').value = func;
            document.getElementById('lowerBound').value = a;
            document.getElementById('upperBound').value = b;
            document.getElementById('useBounds').checked = true;
            document.getElementById('boundsInputs').style.display = 'grid';
            validateFunction();
            validateBounds();
            document.getElementById('calculator-section').scrollIntoView({ behavior: 'smooth' });
        }

        // ‚îÄ‚îÄ Validation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function validateFunction() {
            const funcStr = document.getElementById('function').value.trim();
            const input = document.getElementById('function');
            const message = document.getElementById('functionValidation');
            if (!funcStr) { input.classList.remove('input-valid','input-invalid'); message.textContent = ''; return; }
            try {
                const f = x => math.evaluate(funcStr, { x });
                f(0);
                input.classList.remove('input-invalid'); input.classList.add('input-valid');
                message.className = 'validation-message validation-success'; message.textContent = '‚úì Valid function';
            } catch (e) {
                input.classList.remove('input-valid'); input.classList.add('input-invalid');
                message.className = 'validation-message validation-error'; message.textContent = '‚úó Invalid syntax';
            }
        }

        function validateBounds() {
            const a = parseFloat(document.getElementById('lowerBound').value);
            const b = parseFloat(document.getElementById('upperBound').value);
            const message = document.getElementById('boundsValidation');
            if (isNaN(a) || isNaN(b)) { message.className='validation-message validation-error'; message.textContent='‚úó Enter valid numbers'; return; }
            if (a >= b) { message.className='validation-message validation-error'; message.textContent='‚úó Lower bound must be less than upper bound'; return; }
            const funcStr = document.getElementById('function').value.trim();
            if (funcStr) {
                try {
                    const f = x => math.evaluate(funcStr, { x });
                    const fa = f(a), fb = f(b);
                    if (fa * fb < 0) { message.className='validation-message validation-success'; message.textContent='‚úì Root exists in this interval (opposite signs)'; }
                    else if (fa * fb > 0) { message.className='validation-message validation-error'; message.textContent='‚úó f(a) and f(b) have same sign ‚Äî no guaranteed root'; }
                } catch(e) { message.textContent=''; }
            }
        }

        // ‚îÄ‚îÄ Copy ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            navigator.clipboard.writeText(element.value).then(() => {
                const btn = event.target;
                const orig = btn.innerHTML;
                btn.innerHTML = '‚úì';
                setTimeout(() => btn.innerHTML = orig, 1000);
            });
        }

        // ‚îÄ‚îÄ Graph ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function plotFunctionGraph(funcStr, a, b, root, precision) {
            if (!document.getElementById('showGraph').checked) return '';
            const canvasId = 'functionGraph';
            const graphHTML = `
                <div class="graph-container">
                    <h3>üìà Function Visualization</h3>
                    <canvas id="${canvasId}"></canvas>
                </div>`;
            setTimeout(() => {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                try {
                    const f = x => math.evaluate(funcStr, { x });
                    const range = b - a, start = a - range * 0.5, end = b + range * 0.5, step = (end - start) / 200;
                    const xValues = [], yValues = [];
                    for (let x = start; x <= end; x += step) {
                        try { const y = f(x); if (isFinite(y)) { xValues.push(x); yValues.push(y); } } catch(e) {}
                    }
                    const css = v => getComputedStyle(document.documentElement).getPropertyValue(v).trim();
                    new Chart(canvas, {
                        type: 'line',
                        data: {
                            labels: xValues.map(x => x.toFixed(2)),
                            datasets: [
                                { label: 'f(x)', data: yValues, borderColor: css('--accent-primary'), backgroundColor: 'transparent', borderWidth: 2, pointRadius: 0, tension: 0.4 },
                                { label: 'x-axis', data: Array(xValues.length).fill(0), borderColor: css('--text-muted'), borderWidth: 1, borderDash: [5,5], pointRadius: 0 },
                                { label: 'Root', data: xValues.map(x => Math.abs(x-root)<step*2 ? f(x) : null), borderColor: css('--success'), backgroundColor: css('--success'), pointRadius: 8, showLine: false }
                            ]
                        },
                        options: {
                            responsive: true, maintainAspectRatio: true, aspectRatio: 2,
                            plugins: { legend: { display: true, labels: { color: css('--text-primary') } }, tooltip: { mode: 'index', intersect: false } },
                            scales: {
                                x: { display: true, title: { display: true, text: 'x', color: css('--text-primary') }, ticks: { maxTicksLimit: 10, color: css('--text-secondary') }, grid: { color: css('--border-color') } },
                                y: { display: true, title: { display: true, text: 'f(x)', color: css('--text-primary') }, ticks: { color: css('--text-secondary') }, grid: { color: css('--border-color') } }
                            }
                        }
                    });
                } catch(e) { console.error('Graph error:', e); }
            }, 100);
            return graphHTML;
        }

        // ‚îÄ‚îÄ Stats ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function generateStatistics(iterations, precision) {
            const last = iterations[iterations.length - 1];
            const avg = iterations.slice(1).reduce((s,i)=>s+i.error,0)/(iterations.length-1||1);
            return `<div class="stats-grid">
                <div class="stat-card"><div class="stat-value">${iterations.length}</div><div class="stat-label">Total Iterations</div></div>
                <div class="stat-card"><div class="stat-value">${last.x.toFixed(precision)}</div><div class="stat-label">Final Root</div></div>
                <div class="stat-card"><div class="stat-value">${Math.abs(last.fx).toFixed(precision)}</div><div class="stat-label">|f(root)|</div></div>
                <div class="stat-card"><div class="stat-value">${avg.toFixed(precision)}</div><div class="stat-label">Avg Error</div></div>
            </div>`;
        }

        // ‚îÄ‚îÄ Compare ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let compareMode = false, bisectionIterations = [];

        function toggleCompareMode() {
            compareMode = !compareMode;
            const btn = document.getElementById('compareBtn');
            btn.style.background = compareMode ? 'var(--accent-primary)' : '';
            btn.style.color = compareMode ? 'white' : '';
        }

        function solveBisection(funcStr, a, b, tolerance, maxIter, precision, errorType) {
            const iterations = [];
            const f = x => math.evaluate(funcStr, { x });
            let iter = 0, converged = false;
            while (iter < maxIter && !converged) {
                iter++;
                const mid = (a+b)/2, fmid = f(mid), fa = f(a), fb = f(b);
                let error = 0;
                if (iter > 1) { const prev = iterations[iter-2].x; error = errorType==='absolute' ? Math.abs(mid-prev) : Math.abs((mid-prev)/mid)*100; }
                iterations.push({ iteration: iter, a, b, x: mid, fx: fmid, error });
                if (Math.abs(fmid)<tolerance||(iter>1&&error<tolerance)) { converged=true; } else { if(fa*fmid<0) b=mid; else a=mid; }
            }
            return iterations;
        }

        // ‚îÄ‚îÄ Solver ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let iterations = [], currentIterationIndex = 0, finalRoot = null;

        function solveRegulaFalsi() {
            iterations = []; bisectionIterations = []; currentIterationIndex = 0; finalRoot = null;
            const errorDiv = document.getElementById('errorMessage');
            const resultsDiv = document.getElementById('resultsSection');
            errorDiv.innerHTML = ''; resultsDiv.innerHTML = ''; resultsDiv.classList.add('hidden');

            const funcStr = document.getElementById('function').value.trim();
            const useBounds = document.getElementById('useBounds').checked;
            const tolerance = parseFloat(document.getElementById('tolerance').value);
            const maxIter = parseInt(document.getElementById('maxIterations').value);
            const precision = parseInt(document.getElementById('precision').value);
            const errorType = document.getElementById('errorType').value;

            if (!funcStr) { showError('Please enter a function'); return; }
            if (tolerance <= 0) { showError('Tolerance must be positive'); return; }
            if (maxIter < 1) { showError('Maximum iterations must be at least 1'); return; }

            let a, b;
            if (useBounds) {
                a = parseFloat(document.getElementById('lowerBound').value);
                b = parseFloat(document.getElementById('upperBound').value);
                if (isNaN(a)||isNaN(b)) { showError('Please enter valid numerical bounds'); return; }
                if (a >= b) { showError('Lower bound must be less than upper bound'); return; }
            } else {
                const sr = findInitialBounds(funcStr);
                if (!sr.success) { showError('Could not find an interval automatically. Please specify bounds.'); return; }
                a = sr.a; b = sr.b;
            }

            let f;
            try { f = x => math.evaluate(funcStr, { x }); f(a); f(b); }
            catch(e) { showError('Invalid function: ' + e.message); return; }

            const fa = f(a), fb = f(b);
            if (fa * fb > 0) { showError(`f(${a}) and f(${b}) have the same sign. No root guaranteed. Choose a different interval.`); return; }
            if (Math.abs(fa) < tolerance) { showSuccess(`Lower bound ${a} is already a root!`); displayFinalResult(a, fa, 0); return; }
            if (Math.abs(fb) < tolerance) { showSuccess(`Upper bound ${b} is already a root!`); displayFinalResult(b, fb, 0); return; }

            let iter = 0, converged = false, a_curr = a, b_curr = b;
            while (iter < maxIter && !converged) {
                iter++;
                const fa_curr = f(a_curr), fb_curr = f(b_curr);
                const x = a_curr - (fa_curr*(b_curr-a_curr))/(fb_curr-fa_curr);
                const fx = f(x);
                let error = 0;
                if (iter > 1) { const prev = iterations[iter-2].x; error = errorType==='absolute' ? Math.abs(x-prev) : Math.abs((x-prev)/x)*100; }
                iterations.push({ iteration: iter, a: a_curr, b: b_curr, fa: fa_curr, fb: fb_curr, x, fx, error });
                if (Math.abs(fx)<tolerance||(iter>1&&error<tolerance)) { converged=true; finalRoot=x; }
                else { if (fa_curr*fx<0) b_curr=x; else a_curr=x; }
            }

            if (!converged) showWarning(`Method did not converge within ${maxIter} iterations.`);
            if (compareMode) bisectionIterations = solveBisection(funcStr, a, b, tolerance, maxIter, precision, errorType);

            displayIteration(0, precision, funcStr, a, b);
            resultsDiv.classList.remove('hidden');

            // Scroll to results table after solving
            setTimeout(() => {
                resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 200);
        }

        function displayIteration(index, precision, funcStr, origA, origB) {
            const resultsDiv = document.getElementById('resultsSection');
            const iter = iterations[index];
            const errorType = document.getElementById('errorType').value;
            const errorUnit = errorType === 'relative' ? '%' : '';

            let html = '<div class="results">';
            const progress = ((index+1)/iterations.length)*100;
            html += `<div class="progress-container"><div class="progress-bar"><div class="progress-fill" style="width:${progress}%"></div></div><div class="progress-text">Iteration ${index+1} of ${iterations.length}</div></div>`;
            if (index === iterations.length-1) html += generateStatistics(iterations, precision);

            html += `<div class="iteration-display">
                <h3>Iteration ${iter.iteration} ‚Äî Detailed Calculation</h3>
                <div class="calculation-step"><strong>Given Interval:</strong> [${iter.a.toFixed(precision)}, ${iter.b.toFixed(precision)}]</div>
                <div class="calculation-step"><strong>Function Values:</strong><br>f(a) = f(${iter.a.toFixed(precision)}) = ${iter.fa.toFixed(precision)}<br>f(b) = f(${iter.b.toFixed(precision)}) = ${iter.fb.toFixed(precision)}</div>
                <div class="calculation-step"><strong>Apply Regula Falsi Formula:</strong><br>
                    x = a ‚àí [f(a) √ó (b ‚àí a)] / [f(b) ‚àí f(a)]<br>
                    x = ${iter.a.toFixed(precision)} ‚àí [${iter.fa.toFixed(precision)} √ó (${iter.b.toFixed(precision)} ‚àí ${iter.a.toFixed(precision)})] / [${iter.fb.toFixed(precision)} ‚àí ${iter.fa.toFixed(precision)}]<br>
                    x = ${iter.x.toFixed(precision)}</div>
                <div class="calculation-step"><strong>New Function Value:</strong><br>f(x) = f(${iter.x.toFixed(precision)}) = ${iter.fx.toFixed(precision)}</div>`;

            if (iter.iteration > 1) {
                html += `<div class="calculation-step"><strong>${errorType==='absolute'?'Absolute':'Relative'} Error:</strong><br>Error = ${iter.error.toFixed(precision)}${errorUnit}</div>`;
            }

            html += `<div class="calculation-step" style="background:var(--accent-light);border-left-color:var(--accent-primary);font-weight:600;">
                <strong>Next Interval:</strong><br>
                ${iter.fa*iter.fx<0 ? `f(a)√óf(x) &lt; 0 ‚Üí root in [${iter.a.toFixed(precision)}, ${iter.x.toFixed(precision)}]` : `f(x)√óf(b) &lt; 0 ‚Üí root in [${iter.x.toFixed(precision)}, ${iter.b.toFixed(precision)}]`}
                </div></div>`;

            if (index < iterations.length-1) {
                html += `<div style="text-align:center;margin:2rem 0;">
                    <button class="btn btn-primary" onclick="nextIteration(${index+1},${precision},'${funcStr.replace(/'/g,"\\'")}',${origA},${origB})">Next Iteration ‚Üí</button>
                    <button class="btn btn-secondary" onclick="skipToEnd(${precision},'${funcStr.replace(/'/g,"\\'")}',${origA},${origB})" style="margin-left:1rem;">Skip to Final Result</button>
                </div>`;
            } else {
                html += `<div class="alert alert-success"><strong>‚úì Converged!</strong> The method has found the root.</div>`;
            }

            html += plotFunctionGraph(funcStr, origA, origB, iterations[iterations.length-1].x, precision);

            // Iteration table ‚Äî always anchor id="iterationTable"
            html += generateIterationTable(precision);

            if (compareMode && bisectionIterations.length > 0 && index === iterations.length-1) {
                html += generateComparisonTable(precision);
            }

            html += `<div style="text-align:center;margin-top:2rem;">
                <button class="btn btn-export" onclick="exportToPDF(${precision})">üìÑ Export Table as PDF</button>
            </div></div>`;

            resultsDiv.innerHTML = html;
        }

        function nextIteration(index, precision, funcStr, origA, origB) {
            currentIterationIndex = index;
            displayIteration(index, precision, funcStr, origA, origB);
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function skipToEnd(precision, funcStr, origA, origB) {
            currentIterationIndex = iterations.length-1;
            displayIteration(iterations.length-1, precision, funcStr, origA, origB);
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function generateIterationTable(precision) {
            const errorType = document.getElementById('errorType').value;
            const errorUnit = errorType === 'relative' ? ' (%)' : '';
            let html = `<div class="table-container" id="iterationTable" style="margin-top:3rem;">
                <h3 style="margin-bottom:1rem;color:var(--accent-primary);padding:1rem 1rem 0;">Complete Iteration Table</h3>
                <table><thead><tr>
                    <th>Iteration</th><th>a</th><th>b</th><th>f(a)</th><th>f(b)</th><th>x</th><th>f(x)</th><th>Error${errorUnit}</th>
                </tr></thead><tbody>`;
            iterations.forEach((iter, idx) => {
                const rowClass = idx === iterations.length-1 ? 'converged' : '';
                html += `<tr class="${rowClass}">
                    <td>${iter.iteration}</td>
                    <td>${iter.a.toFixed(precision)}</td>
                    <td>${iter.b.toFixed(precision)}</td>
                    <td>${iter.fa.toFixed(precision)}</td>
                    <td>${iter.fb.toFixed(precision)}</td>
                    <td>${iter.x.toFixed(precision)}</td>
                    <td>${iter.fx.toFixed(precision)}</td>
                    <td>${iter.iteration===1?'‚àí':iter.error.toFixed(precision)}</td>
                </tr>`;
            });
            html += `</tbody></table></div>`;
            if (finalRoot !== null) {
                html += `<div class="alert alert-success" style="margin-top:2rem;">
                    <strong>‚úì Final Root:</strong> x ‚âà ${iterations[iterations.length-1].x.toFixed(precision)}<br>
                    <strong>Function Value:</strong> f(x) ‚âà ${iterations[iterations.length-1].fx.toFixed(precision)}<br>
                    <strong>Total Iterations:</strong> ${iterations.length}
                </div>`;
            }
            return html;
        }

        function generateComparisonTable(precision) {
            const rf = iterations[iterations.length-1], bi = bisectionIterations[bisectionIterations.length-1];
            return `<div class="compare-mode">
                <h3 style="color:var(--accent-primary);margin-bottom:1rem;">üìä Comparison: Regula Falsi vs Bisection</h3>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value">${iterations.length}</div><div class="stat-label">Regula Falsi Iterations</div></div>
                    <div class="stat-card"><div class="stat-value">${bisectionIterations.length}</div><div class="stat-label">Bisection Iterations</div></div>
                    <div class="stat-card"><div class="stat-value">${rf.x.toFixed(precision)}</div><div class="stat-label">Regula Falsi Root</div></div>
                    <div class="stat-card"><div class="stat-value">${bi.x.toFixed(precision)}</div><div class="stat-label">Bisection Root</div></div>
                </div>
                <p style="margin-top:1rem;text-align:center;">
                    <strong>Winner:</strong> ${iterations.length < bisectionIterations.length ? 'Regula Falsi üèÜ' : iterations.length > bisectionIterations.length ? 'Bisection üèÜ' : 'Tie ü§ù'}
                </p>
            </div>`;
        }

        function exportToPDF(precision) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(18); doc.setFont(undefined,'bold');
            doc.text('Regula Falsi Method ‚Äî Iteration Results', 14, 20);
            doc.setFontSize(11); doc.setFont(undefined,'normal');
            doc.text(`Function: f(x) = ${document.getElementById('function').value}`, 14, 30);
            doc.text(`Tolerance: ${document.getElementById('tolerance').value}`, 14, 37);
            doc.text(`Error Type: ${document.getElementById('errorType').value}`, 14, 44);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 14, 51);
            const errorType = document.getElementById('errorType').value;
            const errorUnit = errorType === 'relative' ? ' (%)' : '';
            const tableData = iterations.map(iter => [
                iter.iteration, iter.a.toFixed(precision), iter.b.toFixed(precision),
                iter.fa.toFixed(precision), iter.fb.toFixed(precision), iter.x.toFixed(precision),
                iter.fx.toFixed(precision), iter.iteration===1?'‚àí':iter.error.toFixed(precision)
            ]);
            doc.autoTable({
                startY: 60,
                head: [['Iter','a','b','f(a)','f(b)','x','f(x)',`Error${errorUnit}`]],
                body: tableData,
                theme: 'grid',
                headStyles: { fillColor: [139,69,19] },
                styles: { fontSize: 9 }
            });
            const finalY = doc.lastAutoTable.finalY + 10;
            doc.setFont(undefined,'bold');
            doc.text(`Final Root: x ‚âà ${iterations[iterations.length-1].x.toFixed(precision)}`, 14, finalY);
            doc.setFont(undefined,'normal');
            doc.text(`f(x) ‚âà ${iterations[iterations.length-1].fx.toFixed(precision)}`, 14, finalY+7);
            doc.text(`Total Iterations: ${iterations.length}`, 14, finalY+14);
            doc.save('regula-falsi-results.pdf');
        }

        function findInitialBounds(funcStr) {
            try {
                const f = x => math.evaluate(funcStr, { x });
                for (let start = -100; start < 100; start += 0.5) {
                    const end = start + 0.5;
                    try { if (f(start)*f(end) < 0) return { success: true, a: start, b: end }; } catch(e) {}
                }
                return { success: false };
            } catch(e) { return { success: false }; }
        }

        function showError(msg) { document.getElementById('errorMessage').innerHTML = `<div class="alert alert-error">${msg}</div>`; }
        function showWarning(msg) { document.getElementById('errorMessage').innerHTML = `<div class="alert alert-warning">${msg}</div>`; }
        function showSuccess(msg) { document.getElementById('errorMessage').innerHTML = `<div class="alert alert-success">${msg}</div>`; }

        function displayFinalResult(root, froot, iters) {
            const precision = parseInt(document.getElementById('precision').value);
            const resultsDiv = document.getElementById('resultsSection');
            resultsDiv.innerHTML = `<div class="results"><div class="alert alert-success"><strong>‚úì Root Found!</strong><br>x = ${root.toFixed(precision)}<br>f(x) = ${froot.toFixed(precision)}<br>Iterations: ${iters}</div></div>`;
            resultsDiv.classList.remove('hidden');
        }

        function resetCalculator() {
            document.getElementById('function').value = 'x^3 - x - 1';
            document.getElementById('lowerBound').value = '1';
            document.getElementById('upperBound').value = '2';
            document.getElementById('tolerance').value = '0.0001';
            document.getElementById('precision').value = '6';
            document.getElementById('maxIterations').value = '100';
            document.getElementById('errorType').value = 'absolute';
            document.getElementById('useBounds').checked = true;
            document.getElementById('showGraph').checked = true;
            document.getElementById('errorMessage').innerHTML = '';
            document.getElementById('resultsSection').innerHTML = '';
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('functionValidation').textContent = '';
            document.getElementById('boundsValidation').textContent = '';
            document.getElementById('function').classList.remove('input-valid','input-invalid');
            iterations = []; bisectionIterations = []; currentIterationIndex = 0; finalRoot = null;
            compareMode = false;
            document.getElementById('compareBtn').style.background = '';
            document.getElementById('compareBtn').style.color = '';
        }
    </script>
</body>
</html>